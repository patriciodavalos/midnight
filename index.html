<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>3D Viewer - STL and STEP</title>
  <script src="https://cdn.jsdelivr.net/npm/three@0.150.1/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.150.1/examples/js/loaders/STLLoader.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three-cad-viewer@1.5.1/dist/three-cad-viewer.min.js"></script>
  <style>
    body { margin: 0; font-family: sans-serif; text-align: center; background: #f0f0f0; }
    canvas { display: block; }
    #viewer-container { width: 100%; height: 80vh; background: white; }
    input { margin: 10px; }
  </style>
</head>
<body>
  <h2>ðŸ§Š 3D Viewer para STL y STEP</h2>
  <input type="file" id="fileInput" accept=".stl,.step,.stp" />
  <div id="viewer-container"></div>

  <script>
    const input = document.getElementById('fileInput');
    const container = document.getElementById('viewer-container');

    input.addEventListener('change', async (event) => {
      const file = event.target.files[0];
      if (!file) return;

      const ext = file.name.split('.').pop().toLowerCase();
      container.innerHTML = ""; // clear previous

      if (ext === 'stl') {
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, container.clientWidth / container.clientHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(container.clientWidth, container.clientHeight);
        container.appendChild(renderer.domElement);

        const loader = new THREE.STLLoader();
        const reader = new FileReader();
        reader.onload = function (e) {
          const geometry = loader.parse(e.target.result);
          const material = new THREE.MeshNormalMaterial();
          const mesh = new THREE.Mesh(geometry, material);
          scene.add(mesh);
          camera.position.z = 100;

          const animate = function () {
            requestAnimationFrame(animate);
            mesh.rotation.y += 0.01;
            renderer.render(scene, camera);
          };
          animate();
        };
        reader.readAsArrayBuffer(file);
      } else if (ext === 'step' || ext === 'stp') {
        const viewer = new TCViewer.Viewer(container, {
          backgroundColor: "#ffffff"
        });
        const arrayBuffer = await file.arrayBuffer();
        viewer.loadModelFromBuffer(arrayBuffer, "stp");
      } else {
        alert("Formato no compatible. Usa STL o STEP.");
      }
    });
  </script>
</body>
</html>
